<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex/"><link rel="search" title="Search" href="../search/"><link rel="next" title="Storage &amp; serialisation backends" href="../interfacing-with-storage/"><link rel="prev" title="Python for High Performance Data Analytics" href="../">
        <link rel="prefetch" href="../_static/ENCCS_logo_light.png" as="image">
        <link rel="prefetch" href="../_static/ENCCS_logo_dark.png" as="image">

    <link rel="shortcut icon" href="../_static/favicon.ico"><!-- Generated with Sphinx 8.2.3 and Furo 2025.09.25 -->
        <title>Tabular data (aka Dataframes) - Your lesson name</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=580074bf" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_lesson.css?v=0c089442" />
    <link rel="stylesheet" type="text/css" href="../_static/term_role_formatting.css?v=4194e21c" />
    <link rel="stylesheet" type="text/css" href="../_static/furo_ext_lesson.css?v=685c8e98" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=a5c4661c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=8dab3a3b" />
    <link rel="stylesheet" type="text/css" href="../_static/overrides.css?v=1c72d2de" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="../"><div class="brand">Your lesson name</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../">
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../_static/ENCCS_logo_light.png" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../_static/ENCCS_logo_dark.png" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Your lesson name</span>
  
</a><form class="sidebar-search-container" method="get" action="../search/" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">The lesson</span></p>
<ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Tabular data (aka Dataframes)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interfacing-with-storage/">Storage &amp; serialisation backends</a></li>
<li class="toctree-l1"><a class="reference internal" href="../visualisation/">Visualisations and dashboards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../benchmarking/">Benchmarking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../multithreading/">Multithreading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dask/">Dask</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quick-reference/">Quick Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guide/">Instructor’s guide</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="https://github.com/ENCCS/python-for-hpda/blob/main//content/tabular-data.md?plain=true" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div><div class="edit-this-page">
  <a class="muted-link" href="https://github.com/ENCCS/python-for-hpda/edit/main//content/tabular-data.md" rel="edit" title="Edit this page">
    <svg><use href="#svg-pencil"></use></svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="tabular-data-aka-dataframes">
<h1>Tabular data (aka Dataframes)<a class="headerlink" href="#tabular-data-aka-dataframes" title="Link to this heading">¶</a></h1>
<div class="admonition-questions questions admonition" id="questions-0">
<p class="admonition-title">Questions</p>
<ul class="simple">
<li><p>What are series and dataframes?</p></li>
<li><p>What do we mean by tidy and untidy data?</p></li>
<li><p>What packages are available in Python to handle dataframes?</p></li>
</ul>
</div>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Learn how to manipulate dataframes in Pandas</p></li>
<li><p>Lazy and eager dataframes in Polars</p></li>
<li><p>Learn how to abstract the underlying libraries away with Narwhals</p></li>
</ul>
</div>
<p>This episode will give an introduction to the concepts of <em>Series</em> and <em>DataFrame</em>
and how they can be manipulated using different Python packages.</p>
<section id="series-and-dataframes">
<h2>Series and dataframes<a class="headerlink" href="#series-and-dataframes" title="Link to this heading">¶</a></h2>
<p>A collection of observations (e.g. a time series or simply a set of observations
of a feature of a phenomenon) can be represented by a homogeneous vector, i.e.
an array where all the elements are of the same type. This is known as a <em>Series</em>
in many frameworks. Several series (of different types) can be used as columns of
a tabular structure called a <em>Dataframe</em>, as depicted in the figure below.</p>
<p><img alt="Structure of dataframe" src="../_images/01_table_dataframe.svg" /></p>
<section id="tidy-vs-untidy-dataframes">
<h3>Tidy vs untidy dataframes<a class="headerlink" href="#tidy-vs-untidy-dataframes" title="Link to this heading">¶</a></h3>
<p>Let us look at the following two dataframes:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-VW50aWR5IGZvcm1hdA==" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-VW50aWR5IGZvcm1hdA==" name="VW50aWR5IGZvcm1hdA==" role="tab" tabindex="0">Untidy format</button><button aria-controls="panel-0-VGlkeSBmb3JtYXQ=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-VGlkeSBmb3JtYXQ=" name="VGlkeSBmb3JtYXQ=" role="tab" tabindex="-1">Tidy format</button></div><div aria-labelledby="tab-0-VW50aWR5IGZvcm1hdA==" class="sphinx-tabs-panel group-tab" id="panel-0-VW50aWR5IGZvcm1hdA==" name="VW50aWR5IGZvcm1hdA==" role="tabpanel" tabindex="0"><div class="table-wrapper docutils container">
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p class="rubric" id="id1"></p>
</td>
<td><p>Runner</p></td>
<td><p>400</p></td>
<td><p>800</p></td>
<td><p>1200</p></td>
<td><p>1500</p></td>
</tr>
<tr class="row-even"><td><p>0</p></td>
<td><p>Runner 1</p></td>
<td><p>64</p></td>
<td><p>128</p></td>
<td><p>192</p></td>
<td><p>240</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>Runner 2</p></td>
<td><p>80</p></td>
<td><p>160</p></td>
<td><p>240</p></td>
<td><p>300</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>Runner 3</p></td>
<td><p>96</p></td>
<td><p>192</p></td>
<td><p>288</p></td>
<td><p>360</p></td>
</tr>
</tbody>
</table>
</div>
</div><div aria-labelledby="tab-0-VGlkeSBmb3JtYXQ=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-VGlkeSBmb3JtYXQ=" name="VGlkeSBmb3JtYXQ=" role="tabpanel" tabindex="0"><div class="table-wrapper docutils container">
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p class="rubric" id="id2"></p>
</td>
<td><p>Runner</p></td>
<td><p>distance</p></td>
<td><p>time</p></td>
</tr>
<tr class="row-even"><td><p>0</p></td>
<td><p>Runner 1</p></td>
<td><p>400</p></td>
<td><p>64</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>Runner 2</p></td>
<td><p>400</p></td>
<td><p>80</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>Runner 3</p></td>
<td><p>400</p></td>
<td><p>96</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>Runner 1</p></td>
<td><p>800</p></td>
<td><p>128</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>Runner 2</p></td>
<td><p>800</p></td>
<td><p>160</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>Runner 3</p></td>
<td><p>800</p></td>
<td><p>192</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><p>Runner 1</p></td>
<td><p>1200</p></td>
<td><p>192</p></td>
</tr>
<tr class="row-odd"><td><p>7</p></td>
<td><p>Runner 2</p></td>
<td><p>1200</p></td>
<td><p>240</p></td>
</tr>
<tr class="row-even"><td><p>8</p></td>
<td><p>Runner 3</p></td>
<td><p>1200</p></td>
<td><p>288</p></td>
</tr>
<tr class="row-odd"><td><p>9</p></td>
<td><p>Runner 1</p></td>
<td><p>1500</p></td>
<td><p>240</p></td>
</tr>
<tr class="row-even"><td><p>10</p></td>
<td><p>Runner 2</p></td>
<td><p>1500</p></td>
<td><p>300</p></td>
</tr>
<tr class="row-odd"><td><p>11</p></td>
<td><p>Runner 3</p></td>
<td><p>1500</p></td>
<td><p>360</p></td>
</tr>
</tbody>
</table>
</div>
</div></div>
<p>Most tabular data is either in a tidy format or a untidy format (some people
refer them as the long format or the wide format). The main differences are
summarised below:</p>
<ul class="simple">
<li><p>In untidy (wide) format, each row represents an observation consisting of
multiple variables and each variable has its own column. This is intuitive and
easy for us to understand and make comparisons across different variables,
calculate statistics, etc.</p></li>
<li><p>In tidy (long) format , i.e. column-oriented format, each row represents only
one variable of the observation, and can be considered “computer readable”.
When it comes to data analysis using Pandas, the tidy format is recommended:</p></li>
<li><p>Each column can be stored as a vector and this not only saves memory but also
allows for vectorized calculations which are much faster.</p></li>
<li><p>It’s easier to filter, group, join and aggregate the data.</p></li>
</ul>
</section>
</section>
<section id="pandas-polars">
<h2>Pandas &amp; Polars<a class="headerlink" href="#pandas-polars" title="Link to this heading">¶</a></h2>
<p>Historically, <a class="reference external" href="https://pandas.pydata.org/">Pandas</a> has been the go-to package
to handle dataframes in Python. It is based on NumPy (each column is a Numpy
vector) and has been the traditional workhorse for tabular data, with a stable
API and a large ecosystem built around it, including the <a class="reference external" href="https://seaborn.pydata.org/">Seaborn</a>
statistical plotting framework.
More recently, <a class="reference external" href="https://docs.pola.rs/">Polars</a> was introduced as a more modern
and faster alternative to handle dataframes. It is written in Rust and supports
out of the box out of core evaluation (i.e. does not need loading the whole
dataset in memory), lazy evaluation of queries and automatically uses multiple
threads. Moreover, experimental GPU support is available through
<a class="reference external" href="https://docs.rapids.ai/api/cudf/stable/">cuDF</a>. In the remainder of this
episode, the <a class="reference external" href="https://www.nyc.gov/site/tlc/about/tlc-trip-record-data.page">NYC taxi</a>
will be used to showcase how datasets can be accessed, summarised and manipulated
in both Pandas and Polars. The dataset can be download in <a class="reference external" href="https://parquet.apache.org/">Parquet</a>
format from the link above (the file for the month of January was used in this
case). The dataset contains information about taxi trips performed in New York,
such as the ID of the vendor, the total fare, pickup and drop-off time and
location (expressed as an ID), type of payment, whether additional fees were
charged and more.</p>
<section id="opening-a-dataset">
<h3>Opening a dataset<a class="headerlink" href="#opening-a-dataset" title="Link to this heading">¶</a></h3>
<p>Assuming the file is called <code class="docutils literal notranslate"><span class="pre">yellow_tripdata_2025-01.parquet</span></code>, the dataset can be
opened as:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-UGFuZGFz" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-1-UGFuZGFz" name="UGFuZGFz" role="tab" tabindex="0">Pandas</button><button aria-controls="panel-1-UG9sYXJz" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-UG9sYXJz" name="UG9sYXJz" role="tab" tabindex="-1">Polars</button></div><div aria-labelledby="tab-1-UGFuZGFz" class="sphinx-tabs-panel group-tab" id="panel-1-UGFuZGFz" name="UGFuZGFz" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span> 
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;yellow_tripdata_2025-01.parquet&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-1-UG9sYXJz" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-UG9sYXJz" name="UG9sYXJz" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">polars</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pl</span> 
<span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;yellow_tripdata_2025-01.parquet&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></div>
</section>
<section id="description-and-summarisation">
<h3>Description and summarisation<a class="headerlink" href="#description-and-summarisation" title="Link to this heading">¶</a></h3>
<p>We can get a first understanding of the contents of a dataframe by printing
the first few lines, the “schema” (i.e. the number and type of each column)
and summary statistics as follows:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-2-UGFuZGFz" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-2-UGFuZGFz" name="UGFuZGFz" role="tab" tabindex="0">Pandas</button><button aria-controls="panel-2-UG9sYXJz" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-2-UG9sYXJz" name="UG9sYXJz" role="tab" tabindex="-1">Polars</button></div><div aria-labelledby="tab-2-UGFuZGFz" class="sphinx-tabs-panel group-tab" id="panel-2-UGFuZGFz" name="UGFuZGFz" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div class="dropdown exercise important admonition" id="exercise-0">
<p class="admonition-title">Output</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>   <span class="n">VendorID</span> <span class="n">tpep_pickup_datetime</span> <span class="n">tpep_dropoff_datetime</span>  <span class="o">...</span>  <span class="n">congestion_surcharge</span>  <span class="n">Airport_fee</span>  <span class="n">cbd_congestion_fee</span>
<span class="mi">0</span>         <span class="mi">1</span>  <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="mi">38</span>   <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">59</span>  <span class="o">...</span>                   <span class="mf">2.5</span>          <span class="mf">0.0</span>                 <span class="mf">0.0</span>
<span class="mi">1</span>         <span class="mi">1</span>  <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mi">40</span>   <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">13</span>  <span class="o">...</span>                   <span class="mf">2.5</span>          <span class="mf">0.0</span>                 <span class="mf">0.0</span>
<span class="mi">2</span>         <span class="mi">1</span>  <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mi">04</span>   <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">46</span><span class="p">:</span><span class="mi">01</span>  <span class="o">...</span>                   <span class="mf">2.5</span>          <span class="mf">0.0</span>                 <span class="mf">0.0</span>
<span class="mi">3</span>         <span class="mi">2</span>  <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mi">27</span>   <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">01</span>  <span class="o">...</span>                   <span class="mf">0.0</span>          <span class="mf">0.0</span>                 <span class="mf">0.0</span>
<span class="mi">4</span>         <span class="mi">2</span>  <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">21</span><span class="p">:</span><span class="mi">34</span>   <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">25</span><span class="p">:</span><span class="mi">06</span>  <span class="o">...</span>                   <span class="mf">0.0</span>          <span class="mf">0.0</span>                 <span class="mf">0.0</span>
</pre></div>
</div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
<div class="dropdown exercise important admonition" id="exercise-1">
<p class="admonition-title">Output</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RangeIndex</span><span class="p">:</span> <span class="mi">3475226</span> <span class="n">entries</span><span class="p">,</span> <span class="mi">0</span> <span class="n">to</span> <span class="mi">3475225</span>
<span class="n">Data</span> <span class="n">columns</span> <span class="p">(</span><span class="n">total</span> <span class="mi">20</span> <span class="n">columns</span><span class="p">):</span>
 <span class="c1">#   Column                 Dtype</span>
<span class="o">---</span>  <span class="o">------</span>                 <span class="o">-----</span>
 <span class="mi">0</span>   <span class="n">VendorID</span>               <span class="n">int32</span>
 <span class="mi">1</span>   <span class="n">tpep_pickup_datetime</span>   <span class="n">datetime64</span><span class="p">[</span><span class="n">us</span><span class="p">]</span>
 <span class="mi">2</span>   <span class="n">tpep_dropoff_datetime</span>  <span class="n">datetime64</span><span class="p">[</span><span class="n">us</span><span class="p">]</span>
 <span class="mi">3</span>   <span class="n">passenger_count</span>        <span class="n">float64</span>
 <span class="mi">4</span>   <span class="n">trip_distance</span>          <span class="n">float64</span>
 <span class="mi">5</span>   <span class="n">RatecodeID</span>             <span class="n">float64</span>
 <span class="mi">6</span>   <span class="n">store_and_fwd_flag</span>     <span class="nb">object</span>
 <span class="mi">7</span>   <span class="n">PULocationID</span>           <span class="n">int32</span>
 <span class="mi">8</span>   <span class="n">DOLocationID</span>           <span class="n">int32</span>
 <span class="mi">9</span>   <span class="n">payment_type</span>           <span class="n">int64</span>
 <span class="mi">10</span>  <span class="n">fare_amount</span>            <span class="n">float64</span>
 <span class="mi">11</span>  <span class="n">extra</span>                  <span class="n">float64</span>
 <span class="mi">12</span>  <span class="n">mta_tax</span>                <span class="n">float64</span>
 <span class="mi">13</span>  <span class="n">tip_amount</span>             <span class="n">float64</span>
 <span class="mi">14</span>  <span class="n">tolls_amount</span>           <span class="n">float64</span>
 <span class="mi">15</span>  <span class="n">improvement_surcharge</span>  <span class="n">float64</span>
 <span class="mi">16</span>  <span class="n">total_amount</span>           <span class="n">float64</span>
 <span class="mi">17</span>  <span class="n">congestion_surcharge</span>   <span class="n">float64</span>
 <span class="mi">18</span>  <span class="n">Airport_fee</span>            <span class="n">float64</span>
 <span class="mi">19</span>  <span class="n">cbd_congestion_fee</span>     <span class="n">float64</span>
<span class="n">dtypes</span><span class="p">:</span> <span class="n">datetime64</span><span class="p">[</span><span class="n">us</span><span class="p">](</span><span class="mi">2</span><span class="p">),</span> <span class="n">float64</span><span class="p">(</span><span class="mi">13</span><span class="p">),</span> <span class="n">int32</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">int64</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nb">object</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">memory</span> <span class="n">usage</span><span class="p">:</span> <span class="mf">490.5</span><span class="o">+</span> <span class="n">MB</span>
</pre></div>
</div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
<div class="dropdown exercise important admonition" id="exercise-2">
<p class="admonition-title">Output</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>           <span class="n">VendorID</span>        <span class="n">tpep_pickup_datetime</span>       <span class="n">tpep_dropoff_datetime</span>  <span class="o">...</span>  <span class="n">congestion_surcharge</span>   <span class="n">Airport_fee</span>  <span class="n">cbd_congestion_fee</span>
<span class="n">count</span>  <span class="mf">3.475226e+06</span>                     <span class="mi">3475226</span>                     <span class="mi">3475226</span>  <span class="o">...</span>          <span class="mf">2.935077e+06</span>  <span class="mf">2.935077e+06</span>        <span class="mf">3.475226e+06</span>
<span class="n">mean</span>   <span class="mf">1.785428e+00</span>  <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">17</span> <span class="mi">11</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">55.910964</span>  <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">17</span> <span class="mi">11</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">56.997901</span>  <span class="o">...</span>          <span class="mf">2.225237e+00</span>  <span class="mf">1.239111e-01</span>        <span class="mf">4.834093e-01</span>
<span class="nb">min</span>    <span class="mf">1.000000e+00</span>         <span class="mi">2024</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span> <span class="mi">20</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">55</span>         <span class="mi">2024</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">18</span> <span class="mi">07</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">40</span>  <span class="o">...</span>         <span class="o">-</span><span class="mf">2.500000e+00</span> <span class="o">-</span><span class="mf">1.750000e+00</span>       <span class="o">-</span><span class="mf">7.500000e-01</span>
<span class="mi">25</span><span class="o">%</span>    <span class="mf">2.000000e+00</span>         <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span> <span class="mi">07</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">01</span>  <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span> <span class="mi">08</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mf">29.500000</span>  <span class="o">...</span>          <span class="mf">2.500000e+00</span>  <span class="mf">0.000000e+00</span>        <span class="mf">0.000000e+00</span>
<span class="mi">50</span><span class="o">%</span>    <span class="mf">2.000000e+00</span>         <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">17</span> <span class="mi">15</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">33</span>         <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">17</span> <span class="mi">15</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">34</span>  <span class="o">...</span>          <span class="mf">2.500000e+00</span>  <span class="mf">0.000000e+00</span>        <span class="mf">7.500000e-01</span>
<span class="mi">75</span><span class="o">%</span>    <span class="mf">2.000000e+00</span>         <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">24</span> <span class="mi">19</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">06</span>         <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">24</span> <span class="mi">19</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">31</span>  <span class="o">...</span>          <span class="mf">2.500000e+00</span>  <span class="mf">0.000000e+00</span>        <span class="mf">7.500000e-01</span>
<span class="nb">max</span>    <span class="mf">7.000000e+00</span>         <span class="mi">2025</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">44</span>         <span class="mi">2025</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span> <span class="mi">23</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mi">11</span>  <span class="o">...</span>          <span class="mf">2.500000e+00</span>  <span class="mf">6.750000e+00</span>        <span class="mf">7.500000e-01</span>
<span class="n">std</span>    <span class="mf">4.263282e-01</span>                         <span class="n">NaN</span>                         <span class="n">NaN</span>  <span class="o">...</span>          <span class="mf">9.039932e-01</span>  <span class="mf">4.725090e-01</span>        <span class="mf">3.619307e-01</span>

<span class="p">[</span><span class="mi">8</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">19</span> <span class="n">columns</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div><div aria-labelledby="tab-2-UG9sYXJz" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-2-UG9sYXJz" name="UG9sYXJz" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div class="dropdown exercise important admonition" id="exercise-3">
<p class="admonition-title">Output</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="err">┌──────────┬──────────────────┬──────────────────┬─────────────────┬───┬──────────────┬──────────────────┬─────────────┬─────────────────┐</span>
<span class="err">│</span> <span class="n">VendorID</span> <span class="err">┆</span> <span class="n">tpep_pickup_date</span> <span class="err">┆</span> <span class="n">tpep_dropoff_dat</span> <span class="err">┆</span> <span class="n">passenger_count</span> <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="n">total_amount</span> <span class="err">┆</span> <span class="n">congestion_surch</span> <span class="err">┆</span> <span class="n">Airport_fee</span> <span class="err">┆</span> <span class="n">cbd_congestion_</span> <span class="err">│</span>
<span class="err">│</span> <span class="o">---</span>      <span class="err">┆</span> <span class="n">time</span>             <span class="err">┆</span> <span class="n">etime</span>            <span class="err">┆</span> <span class="o">---</span>             <span class="err">┆</span>   <span class="err">┆</span> <span class="o">---</span>          <span class="err">┆</span> <span class="n">arge</span>             <span class="err">┆</span> <span class="o">---</span>         <span class="err">┆</span> <span class="n">fee</span>             <span class="err">│</span>
<span class="err">│</span> <span class="n">i32</span>      <span class="err">┆</span> <span class="o">---</span>              <span class="err">┆</span> <span class="o">---</span>              <span class="err">┆</span> <span class="n">i64</span>             <span class="err">┆</span>   <span class="err">┆</span> <span class="n">f64</span>          <span class="err">┆</span> <span class="o">---</span>              <span class="err">┆</span> <span class="n">f64</span>         <span class="err">┆</span> <span class="o">---</span>             <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="n">datetime</span><span class="p">[</span><span class="n">μs</span><span class="p">]</span>     <span class="err">┆</span> <span class="n">datetime</span><span class="p">[</span><span class="n">μs</span><span class="p">]</span>     <span class="err">┆</span>                 <span class="err">┆</span>   <span class="err">┆</span>              <span class="err">┆</span> <span class="n">f64</span>              <span class="err">┆</span>             <span class="err">┆</span> <span class="n">f64</span>             <span class="err">│</span>
<span class="err">╞══════════╪══════════════════╪══════════════════╪═════════════════╪═══╪══════════════╪══════════════════╪═════════════╪═════════════════╡</span>
<span class="err">│</span> <span class="mi">1</span>        <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>       <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>       <span class="err">┆</span> <span class="mi">1</span>               <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="mf">18.0</span>         <span class="err">┆</span> <span class="mf">2.5</span>              <span class="err">┆</span> <span class="mf">0.0</span>         <span class="err">┆</span> <span class="mf">0.0</span>             <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="mi">38</span>         <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">59</span>         <span class="err">┆</span>                 <span class="err">┆</span>   <span class="err">┆</span>              <span class="err">┆</span>                  <span class="err">┆</span>             <span class="err">┆</span>                 <span class="err">│</span>
<span class="err">│</span> <span class="mi">1</span>        <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>       <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>       <span class="err">┆</span> <span class="mi">1</span>               <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="mf">12.12</span>        <span class="err">┆</span> <span class="mf">2.5</span>              <span class="err">┆</span> <span class="mf">0.0</span>         <span class="err">┆</span> <span class="mf">0.0</span>             <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mi">40</span>         <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">13</span>         <span class="err">┆</span>                 <span class="err">┆</span>   <span class="err">┆</span>              <span class="err">┆</span>                  <span class="err">┆</span>             <span class="err">┆</span>                 <span class="err">│</span>
<span class="err">│</span> <span class="mi">1</span>        <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>       <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>       <span class="err">┆</span> <span class="mi">1</span>               <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="mf">12.1</span>         <span class="err">┆</span> <span class="mf">2.5</span>              <span class="err">┆</span> <span class="mf">0.0</span>         <span class="err">┆</span> <span class="mf">0.0</span>             <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mi">04</span>         <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">46</span><span class="p">:</span><span class="mi">01</span>         <span class="err">┆</span>                 <span class="err">┆</span>   <span class="err">┆</span>              <span class="err">┆</span>                  <span class="err">┆</span>             <span class="err">┆</span>                 <span class="err">│</span>
<span class="err">│</span> <span class="mi">2</span>        <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>       <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>       <span class="err">┆</span> <span class="mi">3</span>               <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="mf">9.7</span>          <span class="err">┆</span> <span class="mf">0.0</span>              <span class="err">┆</span> <span class="mf">0.0</span>         <span class="err">┆</span> <span class="mf">0.0</span>             <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mi">27</span>         <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">01</span>         <span class="err">┆</span>                 <span class="err">┆</span>   <span class="err">┆</span>              <span class="err">┆</span>                  <span class="err">┆</span>             <span class="err">┆</span>                 <span class="err">│</span>
<span class="err">│</span> <span class="mi">2</span>        <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>       <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>       <span class="err">┆</span> <span class="mi">3</span>               <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="mf">8.3</span>          <span class="err">┆</span> <span class="mf">0.0</span>              <span class="err">┆</span> <span class="mf">0.0</span>         <span class="err">┆</span> <span class="mf">0.0</span>             <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">21</span><span class="p">:</span><span class="mi">34</span>         <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">25</span><span class="p">:</span><span class="mi">06</span>         <span class="err">┆</span>                 <span class="err">┆</span>   <span class="err">┆</span>              <span class="err">┆</span>                  <span class="err">┆</span>             <span class="err">┆</span>                 <span class="err">│</span>
<span class="err">└──────────┴──────────────────┴──────────────────┴─────────────────┴───┴──────────────┴──────────────────┴─────────────┴─────────────────┘</span>
</pre></div>
</div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
<div class="dropdown exercise important admonition" id="exercise-4">
<p class="admonition-title">Output</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
<span class="err">┌────────────┬────────────┬──────────────────┬─────────────────┬───┬──────────────┬─────────────────┬─────────────┬─────────────────┐</span>
<span class="err">│</span> <span class="n">statistic</span>  <span class="err">┆</span> <span class="n">VendorID</span>   <span class="err">┆</span> <span class="n">tpep_pickup_date</span> <span class="err">┆</span> <span class="n">tpep_dropoff_da</span> <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="n">total_amount</span> <span class="err">┆</span> <span class="n">congestion_surc</span> <span class="err">┆</span> <span class="n">Airport_fee</span> <span class="err">┆</span> <span class="n">cbd_congestion_</span> <span class="err">│</span>
<span class="err">│</span> <span class="o">---</span>        <span class="err">┆</span> <span class="o">---</span>        <span class="err">┆</span> <span class="n">time</span>             <span class="err">┆</span> <span class="n">tetime</span>          <span class="err">┆</span>   <span class="err">┆</span> <span class="o">---</span>          <span class="err">┆</span> <span class="n">harge</span>           <span class="err">┆</span> <span class="o">---</span>         <span class="err">┆</span> <span class="n">fee</span>             <span class="err">│</span>
<span class="err">│</span> <span class="nb">str</span>        <span class="err">┆</span> <span class="n">f64</span>        <span class="err">┆</span> <span class="o">---</span>              <span class="err">┆</span> <span class="o">---</span>             <span class="err">┆</span>   <span class="err">┆</span> <span class="n">f64</span>          <span class="err">┆</span> <span class="o">---</span>             <span class="err">┆</span> <span class="n">f64</span>         <span class="err">┆</span> <span class="o">---</span>             <span class="err">│</span>
<span class="err">│</span>            <span class="err">┆</span>            <span class="err">┆</span> <span class="nb">str</span>              <span class="err">┆</span> <span class="nb">str</span>             <span class="err">┆</span>   <span class="err">┆</span>              <span class="err">┆</span> <span class="n">f64</span>             <span class="err">┆</span>             <span class="err">┆</span> <span class="n">f64</span>             <span class="err">│</span>
<span class="err">╞════════════╪════════════╪══════════════════╪═════════════════╪═══╪══════════════╪═════════════════╪═════════════╪═════════════════╡</span>
<span class="err">│</span> <span class="n">count</span>      <span class="err">┆</span> <span class="mf">3.475226e6</span> <span class="err">┆</span> <span class="mi">3475226</span>          <span class="err">┆</span> <span class="mi">3475226</span>         <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="mf">3.475226e6</span>   <span class="err">┆</span> <span class="mf">2.935077e6</span>      <span class="err">┆</span> <span class="mf">2.935077e6</span>  <span class="err">┆</span> <span class="mf">3.475226e6</span>      <span class="err">│</span>
<span class="err">│</span> <span class="n">null_count</span> <span class="err">┆</span> <span class="mf">0.0</span>        <span class="err">┆</span> <span class="mi">0</span>                <span class="err">┆</span> <span class="mi">0</span>               <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="mf">0.0</span>          <span class="err">┆</span> <span class="mf">540149.0</span>        <span class="err">┆</span> <span class="mf">540149.0</span>    <span class="err">┆</span> <span class="mf">0.0</span>             <span class="err">│</span>
<span class="err">│</span> <span class="n">mean</span>       <span class="err">┆</span> <span class="mf">1.785428</span>   <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">17</span>       <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">17</span>      <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="mf">25.611292</span>    <span class="err">┆</span> <span class="mf">2.225237</span>        <span class="err">┆</span> <span class="mf">0.123911</span>    <span class="err">┆</span> <span class="mf">0.483409</span>        <span class="err">│</span>
<span class="err">│</span>            <span class="err">┆</span>            <span class="err">┆</span> <span class="mi">11</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">55.910964</span>  <span class="err">┆</span> <span class="mi">11</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">56.997901</span> <span class="err">┆</span>   <span class="err">┆</span>              <span class="err">┆</span>                 <span class="err">┆</span>             <span class="err">┆</span>                 <span class="err">│</span>
<span class="err">│</span> <span class="n">std</span>        <span class="err">┆</span> <span class="mf">0.426328</span>   <span class="err">┆</span> <span class="n">null</span>             <span class="err">┆</span> <span class="n">null</span>            <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="mf">463.658478</span>   <span class="err">┆</span> <span class="mf">0.903993</span>        <span class="err">┆</span> <span class="mf">0.472509</span>    <span class="err">┆</span> <span class="mf">0.361931</span>        <span class="err">│</span>
<span class="err">│</span> <span class="nb">min</span>        <span class="err">┆</span> <span class="mf">1.0</span>        <span class="err">┆</span> <span class="mi">2024</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span>       <span class="err">┆</span> <span class="mi">2024</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">18</span>      <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="o">-</span><span class="mf">901.0</span>       <span class="err">┆</span> <span class="o">-</span><span class="mf">2.5</span>            <span class="err">┆</span> <span class="o">-</span><span class="mf">1.75</span>       <span class="err">┆</span> <span class="o">-</span><span class="mf">0.75</span>           <span class="err">│</span>
<span class="err">│</span>            <span class="err">┆</span>            <span class="err">┆</span> <span class="mi">20</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">55</span>         <span class="err">┆</span> <span class="mi">07</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">40</span>        <span class="err">┆</span>   <span class="err">┆</span>              <span class="err">┆</span>                 <span class="err">┆</span>             <span class="err">┆</span>                 <span class="err">│</span>
<span class="err">│</span> <span class="mi">25</span><span class="o">%</span>        <span class="err">┆</span> <span class="mf">2.0</span>        <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>       <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>      <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="mf">15.2</span>         <span class="err">┆</span> <span class="mf">2.5</span>             <span class="err">┆</span> <span class="mf">0.0</span>         <span class="err">┆</span> <span class="mf">0.0</span>             <span class="err">│</span>
<span class="err">│</span>            <span class="err">┆</span>            <span class="err">┆</span> <span class="mi">07</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">01</span>         <span class="err">┆</span> <span class="mi">08</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">29</span>        <span class="err">┆</span>   <span class="err">┆</span>              <span class="err">┆</span>                 <span class="err">┆</span>             <span class="err">┆</span>                 <span class="err">│</span>
<span class="err">│</span> <span class="mi">50</span><span class="o">%</span>        <span class="err">┆</span> <span class="mf">2.0</span>        <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">17</span>       <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">17</span>      <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="mf">19.95</span>        <span class="err">┆</span> <span class="mf">2.5</span>             <span class="err">┆</span> <span class="mf">0.0</span>         <span class="err">┆</span> <span class="mf">0.75</span>            <span class="err">│</span>
<span class="err">│</span>            <span class="err">┆</span>            <span class="err">┆</span> <span class="mi">15</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">34</span>         <span class="err">┆</span> <span class="mi">15</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">34</span>        <span class="err">┆</span>   <span class="err">┆</span>              <span class="err">┆</span>                 <span class="err">┆</span>             <span class="err">┆</span>                 <span class="err">│</span>
<span class="err">│</span> <span class="mi">75</span><span class="o">%</span>        <span class="err">┆</span> <span class="mf">2.0</span>        <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">24</span>       <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">24</span>      <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="mf">27.78</span>        <span class="err">┆</span> <span class="mf">2.5</span>             <span class="err">┆</span> <span class="mf">0.0</span>         <span class="err">┆</span> <span class="mf">0.75</span>            <span class="err">│</span>
<span class="err">│</span>            <span class="err">┆</span>            <span class="err">┆</span> <span class="mi">19</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">06</span>         <span class="err">┆</span> <span class="mi">19</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">31</span>        <span class="err">┆</span>   <span class="err">┆</span>              <span class="err">┆</span>                 <span class="err">┆</span>             <span class="err">┆</span>                 <span class="err">│</span>
<span class="err">│</span> <span class="nb">max</span>        <span class="err">┆</span> <span class="mf">7.0</span>        <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span>       <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span>      <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="mf">863380.37</span>    <span class="err">┆</span> <span class="mf">2.5</span>             <span class="err">┆</span> <span class="mf">6.75</span>        <span class="err">┆</span> <span class="mf">0.75</span>            <span class="err">│</span>
<span class="err">│</span>            <span class="err">┆</span>            <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">44</span>         <span class="err">┆</span> <span class="mi">23</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mi">11</span>        <span class="err">┆</span>   <span class="err">┆</span>              <span class="err">┆</span>                 <span class="err">┆</span>             <span class="err">┆</span>                 <span class="err">│</span>
<span class="err">└────────────┴────────────┴──────────────────┴─────────────────┴───┴──────────────┴─────────────────┴─────────────┴─────────────────┘</span>
</pre></div>
</div>
</div>
</div></div>
</section>
<section id="indexing">
<h3>Indexing<a class="headerlink" href="#indexing" title="Link to this heading">¶</a></h3>
<p>We can index data in the dataframe as follows:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-3-UGFuZGFz" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-3-UGFuZGFz" name="UGFuZGFz" role="tab" tabindex="0">Pandas</button><button aria-controls="panel-3-UG9sYXJz" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-3-UG9sYXJz" name="UG9sYXJz" role="tab" tabindex="-1">Polars</button></div><div aria-labelledby="tab-3-UGFuZGFz" class="sphinx-tabs-panel group-tab" id="panel-3-UGFuZGFz" name="UGFuZGFz" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># With this we can select a column</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;VendorID&#39;</span><span class="p">]</span> <span class="c1"># Could also be df.VendorID </span>
</pre></div>
</div>
<div class="dropdown exercise important admonition" id="exercise-5">
<p class="admonition-title">Output</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="mi">0</span>          <span class="mi">1</span>
<span class="mi">1</span>          <span class="mi">1</span>
<span class="mi">2</span>          <span class="mi">1</span>
<span class="mi">3</span>          <span class="mi">2</span>
<span class="mi">4</span>          <span class="mi">2</span>
          <span class="o">..</span>
<span class="mi">3475221</span>    <span class="mi">2</span>
<span class="mi">3475222</span>    <span class="mi">2</span>
<span class="mi">3475223</span>    <span class="mi">2</span>
<span class="mi">3475224</span>    <span class="mi">2</span>
<span class="mi">3475225</span>    <span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get a row </span>
<span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1000</span><span class="p">,:]</span>
</pre></div>
</div>
<div class="dropdown exercise important admonition" id="exercise-6">
<p class="admonition-title">Output</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">VendorID</span>                                   <span class="mi">2</span>
<span class="n">tpep_pickup_datetime</span>     <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mi">06</span>
<span class="n">tpep_dropoff_datetime</span>    <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">20</span>
<span class="n">passenger_count</span>                          <span class="mf">4.0</span>
<span class="n">trip_distance</span>                           <span class="mf">1.53</span>
<span class="n">RatecodeID</span>                               <span class="mf">1.0</span>
<span class="n">store_and_fwd_flag</span>                         <span class="n">N</span>
<span class="n">PULocationID</span>                             <span class="mi">114</span>
<span class="n">DOLocationID</span>                              <span class="mi">90</span>
<span class="n">payment_type</span>                               <span class="mi">1</span>
<span class="n">fare_amount</span>                             <span class="mf">10.0</span>
<span class="n">extra</span>                                    <span class="mf">1.0</span>
<span class="n">mta_tax</span>                                  <span class="mf">0.5</span>
<span class="n">tip_amount</span>                              <span class="mf">2.25</span>
<span class="n">tolls_amount</span>                             <span class="mf">0.0</span>
<span class="n">improvement_surcharge</span>                    <span class="mf">1.0</span>
<span class="n">total_amount</span>                           <span class="mf">17.25</span>
<span class="n">congestion_surcharge</span>                     <span class="mf">2.5</span>
<span class="n">Airport_fee</span>                              <span class="mf">0.0</span>
<span class="n">cbd_congestion_fee</span>                       <span class="mf">0.0</span>
<span class="n">Name</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1000</span><span class="p">,:]</span>
<span class="n">VendorID</span>                                   <span class="mi">2</span>
<span class="n">tpep_pickup_datetime</span>     <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mi">06</span>
<span class="n">tpep_dropoff_datetime</span>    <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">20</span>
<span class="n">passenger_count</span>                          <span class="mf">4.0</span>
<span class="n">trip_distance</span>                           <span class="mf">1.53</span>
<span class="n">RatecodeID</span>                               <span class="mf">1.0</span>
<span class="n">store_and_fwd_flag</span>                         <span class="n">N</span>
<span class="n">PULocationID</span>                             <span class="mi">114</span>
<span class="n">DOLocationID</span>                              <span class="mi">90</span>
<span class="n">payment_type</span>                               <span class="mi">1</span>
<span class="n">fare_amount</span>                             <span class="mf">10.0</span>
<span class="n">extra</span>                                    <span class="mf">1.0</span>
<span class="n">mta_tax</span>                                  <span class="mf">0.5</span>
<span class="n">tip_amount</span>                              <span class="mf">2.25</span>
<span class="n">tolls_amount</span>                             <span class="mf">0.0</span>
<span class="n">improvement_surcharge</span>                    <span class="mf">1.0</span>
<span class="n">total_amount</span>                           <span class="mf">17.25</span>
<span class="n">congestion_surcharge</span>                     <span class="mf">2.5</span>
<span class="n">Airport_fee</span>                              <span class="mf">0.0</span>
<span class="n">cbd_congestion_fee</span>                       <span class="mf">0.0</span>
</pre></div>
</div>
</div>
</div><div aria-labelledby="tab-3-UG9sYXJz" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-3-UG9sYXJz" name="UG9sYXJz" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;VendorID&quot;</span><span class="p">]</span> <span class="c1"># A more Polars-y idiom is to use df.select([&quot;VendorID&quot;])</span>
</pre></div>
</div>
<div class="admonition-output exercise important admonition" id="exercise-7">
<p class="admonition-title">Output</p>
<p>:class: dropdown</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="mi">3_475_226</span><span class="p">,)</span>
<span class="n">Series</span><span class="p">:</span> <span class="s1">&#39;VendorID&#39;</span> <span class="p">[</span><span class="n">i32</span><span class="p">]</span>
<span class="p">[</span>
 <span class="mi">1</span>
 <span class="mi">1</span>
 <span class="mi">1</span>
 <span class="mi">2</span>
 <span class="mi">2</span>
 <span class="err">…</span>
 <span class="mi">2</span>
 <span class="mi">2</span>
 <span class="mi">2</span>
 <span class="mi">2</span>
 <span class="mi">2</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="mi">1000</span><span class="p">][:]</span>
</pre></div>
</div>
<div class="dropdown exercise important admonition" id="exercise-8">
<p class="admonition-title">Output</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="err">┌──────────┬─────────────┬─────────────┬────────────┬───┬────────────┬────────────┬────────────┬────────────┐</span>
<span class="err">│</span> <span class="n">VendorID</span> <span class="err">┆</span> <span class="n">tpep_pickup</span> <span class="err">┆</span> <span class="n">tpep_dropof</span> <span class="err">┆</span> <span class="n">passenger_</span> <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="n">total_amou</span> <span class="err">┆</span> <span class="n">congestion</span> <span class="err">┆</span> <span class="n">Airport_fe</span> <span class="err">┆</span> <span class="n">cbd_conges</span> <span class="err">│</span>
<span class="err">│</span> <span class="o">---</span>      <span class="err">┆</span> <span class="n">_datetime</span>   <span class="err">┆</span> <span class="n">f_datetime</span>  <span class="err">┆</span> <span class="n">count</span>      <span class="err">┆</span>   <span class="err">┆</span> <span class="n">nt</span>         <span class="err">┆</span> <span class="n">_surcharge</span> <span class="err">┆</span> <span class="n">e</span>          <span class="err">┆</span> <span class="n">tion_fee</span>   <span class="err">│</span>
<span class="err">│</span> <span class="n">i32</span>      <span class="err">┆</span> <span class="o">---</span>         <span class="err">┆</span> <span class="o">---</span>         <span class="err">┆</span> <span class="o">---</span>        <span class="err">┆</span>   <span class="err">┆</span> <span class="o">---</span>        <span class="err">┆</span> <span class="o">---</span>        <span class="err">┆</span> <span class="o">---</span>        <span class="err">┆</span> <span class="o">---</span>        <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="n">datetime</span><span class="p">[</span><span class="n">μs</span> <span class="err">┆</span> <span class="n">datetime</span><span class="p">[</span><span class="n">μs</span> <span class="err">┆</span> <span class="n">i64</span>        <span class="err">┆</span>   <span class="err">┆</span> <span class="n">f64</span>        <span class="err">┆</span> <span class="n">f64</span>        <span class="err">┆</span> <span class="n">f64</span>        <span class="err">┆</span> <span class="n">f64</span>        <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="p">]</span>           <span class="err">┆</span> <span class="p">]</span>           <span class="err">┆</span>            <span class="err">┆</span>   <span class="err">┆</span>            <span class="err">┆</span>            <span class="err">┆</span>            <span class="err">┆</span>            <span class="err">│</span>
<span class="err">╞══════════╪═════════════╪═════════════╪════════════╪═══╪════════════╪════════════╪════════════╪════════════╡</span>
<span class="err">│</span> <span class="mi">2</span>        <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>  <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>  <span class="err">┆</span> <span class="mi">4</span>          <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="mf">17.25</span>      <span class="err">┆</span> <span class="mf">2.5</span>        <span class="err">┆</span> <span class="mf">0.0</span>        <span class="err">┆</span> <span class="mf">0.0</span>        <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mi">06</span>    <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">20</span>    <span class="err">┆</span>            <span class="err">┆</span>   <span class="err">┆</span>            <span class="err">┆</span>            <span class="err">┆</span>            <span class="err">┆</span>            <span class="err">│</span>
<span class="err">└──────────┴─────────────┴─────────────┴────────────┴───┴────────────┴────────────┴────────────┴────────────┘</span>
</pre></div>
</div>
</div>
</div></div>
<p>In both cases, a similar syntax can be used to do in-place modification (e.g. <code class="docutils literal notranslate"><span class="pre">df[row][column]=...</span></code>).
Please note that this kind of replacement carries a big performance penalty,
which is designed to do column-wide operations with minimal overhead. This is
commonly achieved through the <a class="reference external" href="https://docs.pola.rs/user-guide/concepts/expressions-and-contexts/">expression API</a>, as detailed in the next section.</p>
</section>
<section id="common-workflows">
<h3>Common workflows<a class="headerlink" href="#common-workflows" title="Link to this heading">¶</a></h3>
<p>It is quite common to compute stratified statistics of different groups to
produce descriptive statistics. This is commonly achieved through a <code class="docutils literal notranslate"><span class="pre">group-by</span></code>
workflow, where the following happens:</p>
<ul class="simple">
<li><p>Splitting: data is partitioned into different groups based on some criterion</p></li>
<li><p>Applying: applying a function/performing a calculation to each group</p></li>
<li><p>Combining: assembling a dataframe (of potentially any size) with the results.</p></li>
</ul>
<p>This is type of workflow is represented below.
<img alt="split-apply-combine" src="../_images/groupby.png" /></p>
<p>As an example, let us try to to compute the total fare for each hour, split
by payment type.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-4-UGFuZGFz" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-4-UGFuZGFz" name="UGFuZGFz" role="tab" tabindex="0">Pandas</button><button aria-controls="panel-4-UG9sYXJz" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-4-UG9sYXJz" name="UG9sYXJz" role="tab" tabindex="-1">Polars</button></div><div aria-labelledby="tab-4-UGFuZGFz" class="sphinx-tabs-panel group-tab" id="panel-4-UGFuZGFz" name="UGFuZGFz" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#First let us extract the hour from the tpep_pickup_datetime column </span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;tpep_pickup_datetime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span> 

<span class="n">hourly_fare</span> <span class="o">=</span> <span class="p">(</span>
  <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;payment_type&#39;</span><span class="p">],</span> <span class="n">observed</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;fare_amount&#39;</span><span class="p">]</span>
  <span class="o">.</span><span class="n">sum</span><span class="p">()</span>
  <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
  <span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;payment_type&#39;</span><span class="p">])</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="dropdown exercise important admonition" id="exercise-9">
<p class="admonition-title">Output</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>     <span class="n">hour</span>  <span class="n">payment_type</span>  <span class="n">fare_amount</span>
<span class="mi">0</span>       <span class="mi">0</span>             <span class="mi">0</span>    <span class="mf">352227.86</span>
<span class="mi">1</span>       <span class="mi">0</span>             <span class="mi">1</span>   <span class="mf">1088201.12</span>
<span class="mi">2</span>       <span class="mi">0</span>             <span class="mi">2</span>    <span class="mf">156546.07</span>
<span class="mi">3</span>       <span class="mi">0</span>             <span class="mi">3</span>      <span class="mf">3537.91</span>
<span class="mi">4</span>       <span class="mi">0</span>             <span class="mi">4</span>      <span class="mf">3941.24</span>
<span class="o">..</span>    <span class="o">...</span>           <span class="o">...</span>          <span class="o">...</span>
<span class="mi">116</span>    <span class="mi">23</span>             <span class="mi">0</span>    <span class="mf">534063.76</span>
<span class="mi">117</span>    <span class="mi">23</span>             <span class="mi">1</span>   <span class="mf">1618143.37</span>
<span class="mi">118</span>    <span class="mi">23</span>             <span class="mi">2</span>    <span class="mf">219991.22</span>
<span class="mi">119</span>    <span class="mi">23</span>             <span class="mi">3</span>      <span class="mf">4765.54</span>
<span class="mi">120</span>    <span class="mi">23</span>             <span class="mi">4</span>      <span class="mf">3293.61</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">groupby</span></code> statement is used to stratify the <code class="docutils literal notranslate"><span class="pre">fare_amount</span></code> column by
hour and payment type. Then the amounts per hour and type get summed and
sorted according to time and payment type.</p>
</div><div aria-labelledby="tab-4-UG9sYXJz" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-4-UG9sYXJz" name="UG9sYXJz" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#First, let us extract the hour from the tpep_pickup_datetime column </span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;tpep_pickup_datetime&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;hour&#39;</span><span class="p">))</span>

<span class="n">hourly_fare</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df</span><span class="o">.</span><span class="n">group_by</span><span class="p">([</span><span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;payment_type&#39;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s1">&#39;fare_amount&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;total_fare&#39;</span><span class="p">))</span>
    <span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;payment_type&#39;</span><span class="p">])</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="dropdown exercise important admonition" id="exercise-10">
<p class="admonition-title">Output</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="err">┌──────┬──────────────┬────────────┐</span>
<span class="err">│</span> <span class="n">hour</span> <span class="err">┆</span> <span class="n">payment_type</span> <span class="err">┆</span> <span class="n">total_fare</span> <span class="err">│</span>
<span class="err">│</span> <span class="o">---</span>  <span class="err">┆</span> <span class="o">---</span>          <span class="err">┆</span> <span class="o">---</span>        <span class="err">│</span>
<span class="err">│</span> <span class="n">i8</span>   <span class="err">┆</span> <span class="n">i64</span>          <span class="err">┆</span> <span class="n">f64</span>        <span class="err">│</span>
<span class="err">╞══════╪══════════════╪════════════╡</span>
<span class="err">│</span> <span class="mi">0</span>    <span class="err">┆</span> <span class="mi">0</span>            <span class="err">┆</span> <span class="mf">352227.86</span>  <span class="err">│</span>
<span class="err">│</span> <span class="mi">0</span>    <span class="err">┆</span> <span class="mi">1</span>            <span class="err">┆</span> <span class="mf">1.0882e6</span>   <span class="err">│</span>
<span class="err">│</span> <span class="mi">0</span>    <span class="err">┆</span> <span class="mi">2</span>            <span class="err">┆</span> <span class="mf">156546.07</span>  <span class="err">│</span>
<span class="err">│</span> <span class="mi">0</span>    <span class="err">┆</span> <span class="mi">3</span>            <span class="err">┆</span> <span class="mf">3537.91</span>    <span class="err">│</span>
<span class="err">│</span> <span class="mi">0</span>    <span class="err">┆</span> <span class="mi">4</span>            <span class="err">┆</span> <span class="mf">3941.24</span>    <span class="err">│</span>
<span class="err">│</span> <span class="err">…</span>    <span class="err">┆</span> <span class="err">…</span>            <span class="err">┆</span> <span class="err">…</span>          <span class="err">│</span>
<span class="err">│</span> <span class="mi">23</span>   <span class="err">┆</span> <span class="mi">0</span>            <span class="err">┆</span> <span class="mf">534063.76</span>  <span class="err">│</span>
<span class="err">│</span> <span class="mi">23</span>   <span class="err">┆</span> <span class="mi">1</span>            <span class="err">┆</span> <span class="mf">1.6181e6</span>   <span class="err">│</span>
<span class="err">│</span> <span class="mi">23</span>   <span class="err">┆</span> <span class="mi">2</span>            <span class="err">┆</span> <span class="mf">219991.22</span>  <span class="err">│</span>
<span class="err">│</span> <span class="mi">23</span>   <span class="err">┆</span> <span class="mi">3</span>            <span class="err">┆</span> <span class="mf">4765.54</span>    <span class="err">│</span>
<span class="err">│</span> <span class="mi">23</span>   <span class="err">┆</span> <span class="mi">4</span>            <span class="err">┆</span> <span class="mf">3293.61</span>    <span class="err">│</span>
<span class="err">└──────┴──────────────┴────────────┘</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">group_by</span></code> statement is used to stratify by hour and payment type,
followed by an aggregated sum of the <code class="docutils literal notranslate"><span class="pre">fare_amount</span></code> column and a sort.
Notice how the syntax has more of a functional programming flavour to it
(<code class="docutils literal notranslate"><span class="pre">pl.col</span></code>, <code class="docutils literal notranslate"><span class="pre">pl.sum</span></code> as pure functions). This will be clarified further in
the next section. Also note that Polars by default spreads the workload
over multiple threads.</p>
</div></div>
</section>
</section>
<section id="idiomatic-polars">
<h2>Idiomatic Polars<a class="headerlink" href="#idiomatic-polars" title="Link to this heading">¶</a></h2>
<p>Polars introduces a few variations to dataset operations compared to the
traditional Pandas approach. In particular, a domain-specific language
(DSL) was developed, where <em>expressions</em> are written to represent dataset
operations and <em>context</em>s provide the environment where they produce a
result.</p>
<section id="expressions">
<h3>Expressions<a class="headerlink" href="#expressions" title="Link to this heading">¶</a></h3>
<p>Let’s say that we created a <code class="docutils literal notranslate"><span class="pre">trip_duration_sec</span></code> column in our NYC cab database
and, given the <code class="docutils literal notranslate"><span class="pre">trip_distance</span></code> column, we want to compute the average speed.
In Polars, this can be achieved with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;trip_distance&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="err">`</span><span class="n">trip_duration_sec</span><span class="err">`</span><span class="p">)</span>
</pre></div>
</div>
<p>This is a lazy representation of an operation we want to perform, which can
be further manipulated or just printed. For it to actually produce data, a
<em>context</em> is needed.</p>
</section>
<section id="contexts">
<h3>Contexts<a class="headerlink" href="#contexts" title="Link to this heading">¶</a></h3>
<p>The same Polars expression can produce different results depending on the
context where it is used. Four common contexts include:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">select</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">with_columns</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">filter</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">group_by</span></code></p></li>
</ul>
<p>Both <code class="docutils literal notranslate"><span class="pre">select</span></code> and <code class="docutils literal notranslate"><span class="pre">with_columns</span></code> can produce new columns, which may be
aggregations, combinations of other columns, or literals. The difference
between the two is that <code class="docutils literal notranslate"><span class="pre">select</span></code> only includes the columns contained in its
input expression, whereas <code class="docutils literal notranslate"><span class="pre">with_columns</span></code> returns a new dataframe which
contains all the columns from the original dataframe and the new ones created
by the expression. To exemplify, using our earlier example of computing the
average speed during a trip, using <code class="docutils literal notranslate"><span class="pre">select</span></code> would yield a single column,
whereas <code class="docutils literal notranslate"><span class="pre">with_columns</span></code> would return the original dataframe with an additional
column called <code class="docutils literal notranslate"><span class="pre">trip</span> <span class="pre">distance</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;trip_distance&#39;</span><span class="p">)</span><span class="o">/</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;trip_duration_sec&#39;</span><span class="p">)</span><span class="o">*</span><span class="mi">3600</span><span class="p">)</span>
<span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="mi">3_475_226</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="err">┌───────────────┐</span>
<span class="err">│</span> <span class="n">trip_distance</span> <span class="err">│</span>
<span class="err">│</span> <span class="o">---</span>           <span class="err">│</span>
<span class="err">│</span> <span class="n">f64</span>           <span class="err">│</span>
<span class="err">╞═══════════════╡</span>
<span class="err">│</span> <span class="mf">11.497006</span>     <span class="err">│</span>
<span class="err">│</span> <span class="mf">11.764706</span>     <span class="err">│</span>
<span class="err">│</span> <span class="mf">18.461538</span>     <span class="err">│</span>
<span class="err">│</span> <span class="mf">5.60479</span>       <span class="err">│</span>
<span class="err">│</span> <span class="mf">11.207547</span>     <span class="err">│</span>
<span class="err">│</span> <span class="err">…</span>             <span class="err">│</span>
<span class="err">│</span> <span class="mf">13.68899</span>      <span class="err">│</span>
<span class="err">│</span> <span class="mf">19.42398</span>      <span class="err">│</span>
<span class="err">│</span> <span class="mf">9.879418</span>      <span class="err">│</span>
<span class="err">│</span> <span class="mf">9.339901</span>      <span class="err">│</span>
<span class="err">│</span> <span class="mf">12.781395</span>     <span class="err">│</span>
<span class="err">└───────────────┘</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">((</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;trip_distance&#39;</span><span class="p">)</span><span class="o">/</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;trip_duration_sec&#39;</span><span class="p">)</span><span class="o">*</span><span class="mi">3600</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;avg_sp</span>
<span class="n">eed_mph</span><span class="s2">&quot;))</span>
<span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="mi">3_475_226</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span>
<span class="err">┌──────────┬──────────┬──────────┬──────────┬───┬──────────┬──────────┬──────────┬──────────┐</span>
<span class="err">│</span> <span class="n">VendorID</span> <span class="err">┆</span> <span class="n">tpep_pic</span> <span class="err">┆</span> <span class="n">tpep_dro</span> <span class="err">┆</span> <span class="n">passenge</span> <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="n">Airport_</span> <span class="err">┆</span> <span class="n">cbd_cong</span> <span class="err">┆</span> <span class="n">trip_dur</span> <span class="err">┆</span> <span class="n">avg_spee</span> <span class="err">│</span>
<span class="err">│</span> <span class="o">---</span>      <span class="err">┆</span> <span class="n">kup_date</span> <span class="err">┆</span> <span class="n">poff_dat</span> <span class="err">┆</span> <span class="n">r_count</span>  <span class="err">┆</span>   <span class="err">┆</span> <span class="n">fee</span>      <span class="err">┆</span> <span class="n">estion_f</span> <span class="err">┆</span> <span class="n">ation_se</span> <span class="err">┆</span> <span class="n">d_mph</span>    <span class="err">│</span>
<span class="err">│</span> <span class="n">i32</span>      <span class="err">┆</span> <span class="n">time</span>     <span class="err">┆</span> <span class="n">etime</span>    <span class="err">┆</span> <span class="o">---</span>      <span class="err">┆</span>   <span class="err">┆</span> <span class="o">---</span>      <span class="err">┆</span> <span class="n">ee</span>       <span class="err">┆</span> <span class="n">c</span>        <span class="err">┆</span> <span class="o">---</span>      <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="o">---</span>      <span class="err">┆</span> <span class="o">---</span>      <span class="err">┆</span> <span class="n">i64</span>      <span class="err">┆</span>   <span class="err">┆</span> <span class="n">f64</span>      <span class="err">┆</span> <span class="o">---</span>      <span class="err">┆</span> <span class="o">---</span>      <span class="err">┆</span> <span class="n">f64</span>      <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="n">datetime</span> <span class="err">┆</span> <span class="n">datetime</span> <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span> <span class="n">f64</span>      <span class="err">┆</span> <span class="n">i64</span>      <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="p">[</span><span class="n">μs</span><span class="p">]</span>     <span class="err">┆</span> <span class="p">[</span><span class="n">μs</span><span class="p">]</span>     <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">╞══════════╪══════════╪══════════╪══════════╪═══╪══════════╪══════════╪══════════╪══════════╡</span>
<span class="err">│</span> <span class="mi">1</span>        <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="mi">1</span>        <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="mf">0.0</span>      <span class="err">┆</span> <span class="mf">0.0</span>      <span class="err">┆</span> <span class="mi">501</span>      <span class="err">┆</span> <span class="mf">11.49700</span> <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">01</span>       <span class="err">┆</span> <span class="mi">01</span>       <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span> <span class="mi">6</span>        <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="mi">38</span> <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">59</span> <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span> <span class="mi">1</span>        <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="mi">1</span>        <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="mf">0.0</span>      <span class="err">┆</span> <span class="mf">0.0</span>      <span class="err">┆</span> <span class="mi">153</span>      <span class="err">┆</span> <span class="mf">11.76470</span> <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">01</span>       <span class="err">┆</span> <span class="mi">01</span>       <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span> <span class="mi">6</span>        <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mi">40</span> <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">13</span> <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span> <span class="mi">1</span>        <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="mi">1</span>        <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="mf">0.0</span>      <span class="err">┆</span> <span class="mf">0.0</span>      <span class="err">┆</span> <span class="mi">117</span>      <span class="err">┆</span> <span class="mf">18.46153</span> <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">01</span>       <span class="err">┆</span> <span class="mi">01</span>       <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span> <span class="mi">8</span>        <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mi">04</span> <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">46</span><span class="p">:</span><span class="mi">01</span> <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span> <span class="mi">2</span>        <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="mi">3</span>        <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="mf">0.0</span>      <span class="err">┆</span> <span class="mf">0.0</span>      <span class="err">┆</span> <span class="mi">334</span>      <span class="err">┆</span> <span class="mf">5.60479</span>  <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">01</span>       <span class="err">┆</span> <span class="mi">01</span>       <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mi">27</span> <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">01</span> <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span> <span class="mi">2</span>        <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="mi">3</span>        <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="mf">0.0</span>      <span class="err">┆</span> <span class="mf">0.0</span>      <span class="err">┆</span> <span class="mi">212</span>      <span class="err">┆</span> <span class="mf">11.20754</span> <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">01</span>       <span class="err">┆</span> <span class="mi">01</span>       <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span> <span class="mi">7</span>        <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">21</span><span class="p">:</span><span class="mi">34</span> <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">25</span><span class="p">:</span><span class="mi">06</span> <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span> <span class="err">…</span>        <span class="err">┆</span> <span class="err">…</span>        <span class="err">┆</span> <span class="err">…</span>        <span class="err">┆</span> <span class="err">…</span>        <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="err">…</span>        <span class="err">┆</span> <span class="err">…</span>        <span class="err">┆</span> <span class="err">…</span>        <span class="err">┆</span> <span class="err">…</span>        <span class="err">│</span>
<span class="err">│</span> <span class="mi">2</span>        <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="n">null</span>     <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="n">null</span>     <span class="err">┆</span> <span class="mf">0.75</span>     <span class="err">┆</span> <span class="mi">881</span>      <span class="err">┆</span> <span class="mf">13.68899</span> <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">31</span>       <span class="err">┆</span> <span class="mi">31</span>       <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">23</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">48</span> <span class="err">┆</span> <span class="mi">23</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">29</span> <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span> <span class="mi">2</span>        <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span> <span class="err">┆</span> <span class="n">null</span>     <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="n">null</span>     <span class="err">┆</span> <span class="mf">0.75</span>     <span class="err">┆</span> <span class="mi">1618</span>     <span class="err">┆</span> <span class="mf">19.42398</span> <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">31</span>       <span class="err">┆</span> <span class="mi">01</span>       <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">23</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">29</span> <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mi">27</span> <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span> <span class="mi">2</span>        <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="n">null</span>     <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="n">null</span>     <span class="err">┆</span> <span class="mf">0.75</span>     <span class="err">┆</span> <span class="mi">962</span>      <span class="err">┆</span> <span class="mf">9.879418</span> <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">31</span>       <span class="err">┆</span> <span class="mi">31</span>       <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">23</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">59</span> <span class="err">┆</span> <span class="mi">23</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="mi">01</span> <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span> <span class="mi">2</span>        <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="n">null</span>     <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="n">null</span>     <span class="err">┆</span> <span class="mf">0.75</span>     <span class="err">┆</span> <span class="mi">1218</span>     <span class="err">┆</span> <span class="mf">9.339901</span> <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">31</span>       <span class="err">┆</span> <span class="mi">31</span>       <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">23</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mi">34</span> <span class="err">┆</span> <span class="mi">23</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">52</span> <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span> <span class="mi">2</span>        <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span> <span class="err">┆</span> <span class="n">null</span>     <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="n">null</span>     <span class="err">┆</span> <span class="mf">0.0</span>      <span class="err">┆</span> <span class="mi">645</span>      <span class="err">┆</span> <span class="mf">12.78139</span> <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">31</span>       <span class="err">┆</span> <span class="mi">01</span>       <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span> <span class="mi">5</span>        <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">23</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mi">42</span> <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">27</span> <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">└──────────┴──────────┴──────────┴──────────┴───┴──────────┴──────────┴──────────┴──────────┘</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">filter</span></code> context filters the rows of a dataframe based on one (or more)
expressions which evaluate to a Boolean, e.g.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;avg_speed_mph&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="mi">104_410</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span>
<span class="err">┌──────────┬──────────┬──────────┬──────────┬───┬──────────┬──────────┬──────────┬──────────┐</span>
<span class="err">│</span> <span class="n">VendorID</span> <span class="err">┆</span> <span class="n">tpep_pic</span> <span class="err">┆</span> <span class="n">tpep_dro</span> <span class="err">┆</span> <span class="n">passenge</span> <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="n">Airport_</span> <span class="err">┆</span> <span class="n">cbd_cong</span> <span class="err">┆</span> <span class="n">trip_dur</span> <span class="err">┆</span> <span class="n">avg_spee</span> <span class="err">│</span>
<span class="err">│</span> <span class="o">---</span>      <span class="err">┆</span> <span class="n">kup_date</span> <span class="err">┆</span> <span class="n">poff_dat</span> <span class="err">┆</span> <span class="n">r_count</span>  <span class="err">┆</span>   <span class="err">┆</span> <span class="n">fee</span>      <span class="err">┆</span> <span class="n">estion_f</span> <span class="err">┆</span> <span class="n">ation_se</span> <span class="err">┆</span> <span class="n">d_mph</span>    <span class="err">│</span>
<span class="err">│</span> <span class="n">i32</span>      <span class="err">┆</span> <span class="n">time</span>     <span class="err">┆</span> <span class="n">etime</span>    <span class="err">┆</span> <span class="o">---</span>      <span class="err">┆</span>   <span class="err">┆</span> <span class="o">---</span>      <span class="err">┆</span> <span class="n">ee</span>       <span class="err">┆</span> <span class="n">c</span>        <span class="err">┆</span> <span class="o">---</span>      <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="o">---</span>      <span class="err">┆</span> <span class="o">---</span>      <span class="err">┆</span> <span class="n">i64</span>      <span class="err">┆</span>   <span class="err">┆</span> <span class="n">f64</span>      <span class="err">┆</span> <span class="o">---</span>      <span class="err">┆</span> <span class="o">---</span>      <span class="err">┆</span> <span class="n">f64</span>      <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="n">datetime</span> <span class="err">┆</span> <span class="n">datetime</span> <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span> <span class="n">f64</span>      <span class="err">┆</span> <span class="n">i64</span>      <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="p">[</span><span class="n">μs</span><span class="p">]</span>     <span class="err">┆</span> <span class="p">[</span><span class="n">μs</span><span class="p">]</span>     <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">╞══════════╪══════════╪══════════╪══════════╪═══╪══════════╪══════════╪══════════╪══════════╡</span>
<span class="err">│</span> <span class="mi">2</span>        <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="mi">1</span>        <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="mf">0.0</span>      <span class="err">┆</span> <span class="mf">0.0</span>      <span class="err">┆</span> <span class="mi">10</span>       <span class="err">┆</span> <span class="mf">0.0</span>      <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">01</span>       <span class="err">┆</span> <span class="mi">01</span>       <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">43</span> <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">53</span> <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span> <span class="mi">2</span>        <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="mi">3</span>        <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="mf">0.0</span>      <span class="err">┆</span> <span class="mf">0.0</span>      <span class="err">┆</span> <span class="mi">8</span>        <span class="err">┆</span> <span class="mf">0.0</span>      <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">01</span>       <span class="err">┆</span> <span class="mi">01</span>       <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">08</span> <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">16</span> <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span> <span class="mi">1</span>        <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="mi">1</span>        <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="mf">0.0</span>      <span class="err">┆</span> <span class="mf">0.0</span>      <span class="err">┆</span> <span class="mi">1910</span>     <span class="err">┆</span> <span class="mf">0.0</span>      <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">01</span>       <span class="err">┆</span> <span class="mi">01</span>       <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">40</span> <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">30</span> <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span> <span class="mi">2</span>        <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="mi">4</span>        <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="mf">0.0</span>      <span class="err">┆</span> <span class="mf">0.0</span>      <span class="err">┆</span> <span class="mi">5</span>        <span class="err">┆</span> <span class="mf">0.0</span>      <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">01</span>       <span class="err">┆</span> <span class="mi">01</span>       <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mi">49</span> <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mi">54</span> <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span> <span class="mi">1</span>        <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="mi">0</span>        <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="mf">0.0</span>      <span class="err">┆</span> <span class="mf">0.0</span>      <span class="err">┆</span> <span class="mi">2</span>        <span class="err">┆</span> <span class="mf">0.0</span>      <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">01</span>       <span class="err">┆</span> <span class="mi">01</span>       <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">42</span><span class="p">:</span><span class="mi">42</span> <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">42</span><span class="p">:</span><span class="mi">44</span> <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span> <span class="err">…</span>        <span class="err">┆</span> <span class="err">…</span>        <span class="err">┆</span> <span class="err">…</span>        <span class="err">┆</span> <span class="err">…</span>        <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="err">…</span>        <span class="err">┆</span> <span class="err">…</span>        <span class="err">┆</span> <span class="err">…</span>        <span class="err">┆</span> <span class="err">…</span>        <span class="err">│</span>
<span class="err">│</span> <span class="mi">1</span>        <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span> <span class="err">┆</span> <span class="n">null</span>     <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="n">null</span>     <span class="err">┆</span> <span class="mf">0.75</span>     <span class="err">┆</span> <span class="mi">266</span>      <span class="err">┆</span> <span class="mf">0.0</span>      <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">31</span>       <span class="err">┆</span> <span class="mi">01</span>       <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">23</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">17</span> <span class="err">┆</span> <span class="mi">00</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">43</span> <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span> <span class="mi">1</span>        <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="n">null</span>     <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="n">null</span>     <span class="err">┆</span> <span class="mf">0.75</span>     <span class="err">┆</span> <span class="mi">1100</span>     <span class="err">┆</span> <span class="mf">0.0</span>      <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">31</span>       <span class="err">┆</span> <span class="mi">31</span>       <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">23</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mi">38</span> <span class="err">┆</span> <span class="mi">23</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">58</span> <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span> <span class="mi">2</span>        <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="n">null</span>     <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="n">null</span>     <span class="err">┆</span> <span class="mf">0.0</span>      <span class="err">┆</span> <span class="mi">161</span>      <span class="err">┆</span> <span class="mf">0.0</span>      <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">31</span>       <span class="err">┆</span> <span class="mi">31</span>       <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">23</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mi">25</span> <span class="err">┆</span> <span class="mi">23</span><span class="p">:</span><span class="mi">42</span><span class="p">:</span><span class="mi">06</span> <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span> <span class="mi">1</span>        <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="n">null</span>     <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="n">null</span>     <span class="err">┆</span> <span class="mf">0.75</span>     <span class="err">┆</span> <span class="mi">24</span>       <span class="err">┆</span> <span class="mf">0.0</span>      <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">31</span>       <span class="err">┆</span> <span class="mi">31</span>       <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">23</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">42</span> <span class="err">┆</span> <span class="mi">23</span><span class="p">:</span><span class="mi">31</span><span class="p">:</span><span class="mi">06</span> <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span> <span class="mi">1</span>        <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span> <span class="err">┆</span> <span class="n">null</span>     <span class="err">┆</span> <span class="err">…</span> <span class="err">┆</span> <span class="n">null</span>     <span class="err">┆</span> <span class="mf">0.75</span>     <span class="err">┆</span> <span class="mi">1556</span>     <span class="err">┆</span> <span class="mf">0.0</span>      <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">31</span>       <span class="err">┆</span> <span class="mi">31</span>       <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">│</span>          <span class="err">┆</span> <span class="mi">23</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">25</span> <span class="err">┆</span> <span class="mi">23</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="mi">21</span> <span class="err">┆</span>          <span class="err">┆</span>   <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">┆</span>          <span class="err">│</span>
<span class="err">└──────────┴──────────┴──────────┴──────────┴───┴──────────┴──────────┴──────────┴──────────┘</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">group_by</span></code> context behaves like its Pandas counterpart.</p>
</section>
<section id="transformations">
<h3>Transformations<a class="headerlink" href="#transformations" title="Link to this heading">¶</a></h3>
<p>A <code class="docutils literal notranslate"><span class="pre">join</span></code> operation combines columns from one or more dataframes into a new
dataframe. There are different joining strategies, which influence how columns
are combined and what rows are included in the final set. A common type is the
<em>equi</em> join, where rows are matched by a key expression. Let us clarify this
with an example. The <code class="docutils literal notranslate"><span class="pre">df</span></code> dataframe does not include specific coordinates for
each pickup and drop-off, rather only a <code class="docutils literal notranslate"><span class="pre">PULocationID</span></code> and a <code class="docutils literal notranslate"><span class="pre">DOLocationID</span></code>.
There is a <code class="docutils literal notranslate"><span class="pre">taxy_zones_xy.csv</span></code> file that contains, for each <code class="docutils literal notranslate"><span class="pre">LocationID</span></code>, the
latitude (X) and longitude (Y) of each location, as well as the name of zone
and borough:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="n">lookup_df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;taxy_zones_xy.csv&#39;</span><span class="p">,</span> <span class="n">has_header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">lookup_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="err">┌────────────┬────────────┬───────────┬─────────────────────────┬───────────────┐</span>
<span class="err">│</span> <span class="n">LocationID</span> <span class="err">┆</span> <span class="n">X</span>          <span class="err">┆</span> <span class="n">Y</span>         <span class="err">┆</span> <span class="n">zone</span>                    <span class="err">┆</span> <span class="n">borough</span>       <span class="err">│</span>
<span class="err">│</span> <span class="o">---</span>        <span class="err">┆</span> <span class="o">---</span>        <span class="err">┆</span> <span class="o">---</span>       <span class="err">┆</span> <span class="o">---</span>                     <span class="err">┆</span> <span class="o">---</span>           <span class="err">│</span>
<span class="err">│</span> <span class="n">i64</span>        <span class="err">┆</span> <span class="n">f64</span>        <span class="err">┆</span> <span class="n">f64</span>       <span class="err">┆</span> <span class="nb">str</span>                     <span class="err">┆</span> <span class="nb">str</span>           <span class="err">│</span>
<span class="err">╞════════════╪════════════╪═══════════╪═════════════════════════╪═══════════════╡</span>
<span class="err">│</span> <span class="mi">1</span>          <span class="err">┆</span> <span class="o">-</span><span class="mf">74.176786</span> <span class="err">┆</span> <span class="mf">40.689516</span> <span class="err">┆</span> <span class="n">Newark</span> <span class="n">Airport</span>          <span class="err">┆</span> <span class="n">EWR</span>           <span class="err">│</span>
<span class="err">│</span> <span class="mi">2</span>          <span class="err">┆</span> <span class="o">-</span><span class="mf">73.826126</span> <span class="err">┆</span> <span class="mf">40.625724</span> <span class="err">┆</span> <span class="n">Jamaica</span> <span class="n">Bay</span>             <span class="err">┆</span> <span class="n">Queens</span>        <span class="err">│</span>
<span class="err">│</span> <span class="mi">3</span>          <span class="err">┆</span> <span class="o">-</span><span class="mf">73.849479</span> <span class="err">┆</span> <span class="mf">40.865888</span> <span class="err">┆</span> <span class="n">Allerton</span><span class="o">/</span><span class="n">Pelham</span> <span class="n">Gardens</span> <span class="err">┆</span> <span class="n">Bronx</span>         <span class="err">│</span>
<span class="err">│</span> <span class="mi">4</span>          <span class="err">┆</span> <span class="o">-</span><span class="mf">73.977023</span> <span class="err">┆</span> <span class="mf">40.724152</span> <span class="err">┆</span> <span class="n">Alphabet</span> <span class="n">City</span>           <span class="err">┆</span> <span class="n">Manhattan</span>     <span class="err">│</span>
<span class="err">│</span> <span class="mi">5</span>          <span class="err">┆</span> <span class="o">-</span><span class="mf">74.18993</span>  <span class="err">┆</span> <span class="mf">40.55034</span>  <span class="err">┆</span> <span class="n">Arden</span> <span class="n">Heights</span>           <span class="err">┆</span> <span class="n">Staten</span> <span class="n">Island</span> <span class="err">│</span>
<span class="err">└────────────┴────────────┴───────────┴─────────────────────────┴───────────────┘</span>
</pre></div>
</div>
<p>This can be used to append these columns to the original df to have some form
of geographical data as follows (e.g. for the <code class="docutils literal notranslate"><span class="pre">PULocationID</span></code>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lookup_df</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;PULocationID&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;LocationID&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span>
<span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;_pickup&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In the line above, <code class="docutils literal notranslate"><span class="pre">left_on</span></code> is used to indicate the <em>key</em> in the original
dataframe, <code class="docutils literal notranslate"><span class="pre">right_on</span></code> is used to specify the <em>key</em> in the <code class="docutils literal notranslate"><span class="pre">lookup_df</span></code> dataframe,
<code class="docutils literal notranslate"><span class="pre">how=left</span></code> means that the columns from the second dataframe will be added to
the first (and not the other way around) and <code class="docutils literal notranslate"><span class="pre">suffix</span></code> is what will be added to
the names of the joined columns (i.e., df will contain columns called <code class="docutils literal notranslate"><span class="pre">X_pickup</span></code>,
<code class="docutils literal notranslate"><span class="pre">Y_pickup</span></code>, <code class="docutils literal notranslate"><span class="pre">zone_pickup</span></code> and <code class="docutils literal notranslate"><span class="pre">borough_pickup</span></code>). More information on join
operations can be found <a class="reference external" href="https://docs.pola.rs/user-guide/transformations/joins/">here</a>.</p>
</section>
</section>
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Link to this heading">¶</a></h2>
<div class="admonition-joining-geographical-data exercise important admonition" id="exercise-11">
<p class="admonition-title">Joining geographical data</p>
<p>We have already seen how to add actual latitude and longitude for the pickups.
Now do the same for the drop-offs!</p>
<div class="admonition-solution solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Solution</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lookup_df</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;DOLocationID&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;LocationID&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span>
<span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;_dropoff&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition-feature-engineering-enriching-the-dataset exercise important admonition" id="exercise-12">
<p class="admonition-title">Feature engineering: enriching the dataset</p>
<p>We want to understand a bit more of the traffic in the city by creating
new features (i.e. columns), in particular:</p>
<ul class="simple">
<li><p>Split the pickup datetime into hour, minute, day of the week and month
to indentify daily, weekly and monthly trends</p></li>
<li><p>Compute the average speed as an indicator of congestion (low speed -&gt;
traffic jam)</p></li>
<li><p>Stratify the trip distance and fare by zone to identify how expensive
different zones are.
Below is a skeleton of the code, where some lines have been blanked out
for you to fill (marked with <code class="docutils literal notranslate"><span class="pre">TODO:...</span></code>)</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">polars</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pl</span>
<span class="n">raw_df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s1">&#39;yellow_tripdata_2025-01.parquet&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">raw_df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">([</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;tpep_pickup_datetime&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;pickup_hour&quot;</span><span class="p">),</span>
    <span class="c1">#TODO: do this for the minute</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;tpep_pickup_datetime&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day_of_week</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;pickup_dow&quot;</span><span class="p">),</span>   <span class="c1"># Mon=0 … Sun=6</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;tpep_pickup_datetime&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;pickup_month&quot;</span><span class="p">),</span>
    <span class="c1"># Trip duration in seconds</span>
    <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;tpep_dropoff_datetime&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;tpep_pickup_datetime&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
        <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;trip_duration_sec&quot;</span><span class="p">),</span>
<span class="p">])</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">with_column</span><span class="p">(</span>
    <span class="c1">#TODO: add expression for average velocity here</span>
    <span class="o">.</span><span class="n">replace_nan</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>                        <span class="c1"># protect against div‑by‑zero</span>
    <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;avg_speed_mph&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Compute per‑pickup‑zone statistics once</span>
<span class="n">zone_stats</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;PULocationID&quot;</span><span class="p">)</span>
      <span class="o">.</span><span class="n">agg</span><span class="p">([</span>
          <span class="n">pl</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;fare_amount&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;zone_avg_fare&quot;</span><span class="p">),</span>
          <span class="c1">#TODO: do the same for the trip distance here</span>
          <span class="n">pl</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;zone_trip_cnt&quot;</span><span class="p">),</span>
      <span class="p">])</span>
      <span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">&quot;PULocationID&quot;</span><span class="p">:</span> <span class="s2">&quot;pickup_zone_id&quot;</span><span class="p">})</span>   <span class="c1"># avoid name clash later</span>
<span class="p">)</span>

<span class="c1"># Join those stats back onto the original rows</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">zone_stats</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;PULocationID&quot;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;pickup_zone_id&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>While we haven’t covered the <code class="docutils literal notranslate"><span class="pre">join</span></code> instruction earlier, its main role
is to “spread” the <code class="docutils literal notranslate"><span class="pre">zone_stats</span></code> over all the rides in the original dataframe
(i.e. write the <code class="docutils literal notranslate"><span class="pre">zone_avg_fare</span></code> on each ride in <code class="docutils literal notranslate"><span class="pre">df</span></code>). <code class="docutils literal notranslate"><span class="pre">join</span></code> has its roots
in relational databases, where different tables can be merged based on a
common column.</p>
<div class="admonition-solution solution important dropdown admonition" id="solution-1">
<p class="admonition-title">Solution</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">polars</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pl</span>
<span class="n">raw_df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s1">&#39;yellow_tripdata_2025-01.parquet&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">raw_df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">([</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;tpep_pickup_datetime&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;pickup_hour&quot;</span><span class="p">),</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;tpep_pickup_datetime&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">minute</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;pickup_minute&quot;</span><span class="p">),</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;tpep_pickup_datetime&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day_of_week</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;pickup_dow&quot;</span><span class="p">),</span>   <span class="c1"># Mon=0 … Sun=6</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;tpep_pickup_datetime&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;pickup_month&quot;</span><span class="p">),</span>
    <span class="c1"># Trip duration in seconds</span>
    <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;tpep_dropoff_datetime&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;tpep_pickup_datetime&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">seconds</span><span class="p">()</span>
        <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;trip_duration_sec&quot;</span><span class="p">),</span>
<span class="p">])</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">with_column</span><span class="p">(</span>
    <span class="p">(</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;trip_distance&quot;</span><span class="p">)</span> <span class="o">/</span>
        <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;trip_duration_sec&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3600</span><span class="p">)</span>   <span class="c1"># seconds → hours</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">replace_nan</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>                        <span class="c1"># protect against div‑by‑zero</span>
    <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;avg_speed_mph&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Compute per‑pickup‑zone statistics once</span>
<span class="n">zone_stats</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;PULocationID&quot;</span><span class="p">)</span>
      <span class="o">.</span><span class="n">agg</span><span class="p">([</span>
          <span class="n">pl</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;fare_amount&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;zone_avg_fare&quot;</span><span class="p">),</span>
          <span class="n">pl</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;trip_distance&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;zone_avg_dist&quot;</span><span class="p">),</span>
          <span class="n">pl</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;zone_trip_cnt&quot;</span><span class="p">),</span>
      <span class="p">])</span>
      <span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">&quot;PULocationID&quot;</span><span class="p">:</span> <span class="s2">&quot;pickup_zone_id&quot;</span><span class="p">})</span>   <span class="c1"># avoid name clash later</span>
<span class="p">)</span>

<span class="c1"># Join those stats back onto the original rows</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">zone_stats</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;PULocationID&quot;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;pickup_zone_id&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition-more-feature-engineering exercise important admonition" id="exercise-13">
<p class="admonition-title">More feature engineering!</p>
<p>Similarly to the exercise above, define the following features in the data:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pickup_hour</span></code> extracted from <code class="docutils literal notranslate"><span class="pre">tpep_pickup_time</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">is_weekend</span></code>, a Boolean value for each trip</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">avg_speed_mph</span></code>, exactly as before</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tip_to_fare_ratio</span></code>, dividing the tip amount by the total fare. Be careful
with division by 0</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fare_per_mile</span></code>, dividing the total fare by the distance</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dist_per_passenger</span></code>, the average distance travelled by each passenger
(sum of all trip distances divided by number of trips)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">speed_per_pickup_area</span></code>, the average velocity stratified by pickup location</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dropoff_trip_count</span></code>, count of trips stratified per dropoff location</p></li>
</ul>
<div class="admonition-solution solution important dropdown admonition" id="solution-2">
<p class="admonition-title">Solution</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">polars</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pl</span>
<span class="n">raw_df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;yellow_tripdata_2025-01.parquet&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">raw_df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">([</span>
    <span class="c1"># 1. pickup_hour</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;tpep_pickup_datetime&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;pickup_hour&quot;</span><span class="p">),</span>

    <span class="c1"># 2. is_weekend (Sat=5, Sun=6)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;tpep_pickup_datetime&quot;</span><span class="p">)</span>
      <span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day_of_week</span><span class="p">()</span>
      <span class="o">.</span><span class="n">is_in</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
      <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;is_weekend&quot;</span><span class="p">),</span>

    <span class="c1"># 3. trip_duration_sec</span>
    <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;tpep_dropoff_datetime&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;tpep_pickup_datetime&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">seconds</span><span class="p">()</span>
        <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;trip_duration_sec&quot;</span><span class="p">),</span>

    <span class="c1"># 4. avg_speed_mph</span>
    <span class="p">(</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;trip_distance&quot;</span><span class="p">)</span> <span class="o">/</span>
        <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;trip_duration_sec&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3600</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">replace_nan</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>                       <span class="c1"># protect against div‑by‑zero</span>
    <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;avg_speed_mph&quot;</span><span class="p">),</span>

    <span class="c1"># 5. tip_to_fare_ratio</span>
    <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;tip_amount&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;fare_amount&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">replace_inf</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="o">.</span><span class="n">replace_nan</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;tip_to_fare_ratio&quot;</span><span class="p">),</span>

    <span class="c1"># 6. fare_per_mile</span>
    <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;fare_amount&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;trip_distance&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">replace_inf</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="o">.</span><span class="n">replace_nan</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;fare_per_mile&quot;</span><span class="p">),</span>

    <span class="c1"># 7. dist_per_passenger</span>
    <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;trip_distance&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;passenger_count&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">replace_inf</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="o">.</span><span class="n">replace_nan</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;dist_per_passenger&quot;</span><span class="p">),</span>
<span class="p">])</span>

<span class="n">dropoff_stats</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;DOLocationID&quot;</span><span class="p">)</span>
      <span class="o">.</span><span class="n">agg</span><span class="p">([</span>
          <span class="n">pl</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;avg_speed_mph&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;dropoff_avg_speed&quot;</span><span class="p">),</span>
          <span class="n">pl</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;dropoff_trip_cnt&quot;</span><span class="p">),</span>
      <span class="p">])</span>
      <span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">&quot;DOLocationID&quot;</span><span class="p">:</span> <span class="s2">&quot;dropoff_zone_id&quot;</span><span class="p">})</span>   <span class="c1"># avoid name clash later</span>
<span class="p">)</span>

<span class="c1"># Join the per‑zone stats back onto every row</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dropoff_stats</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;DOLocationID&quot;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;dropoff_zone_id&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<p>We have seen how to deal with common workflows in both Pandas and Polars,
starting from basic tasks like opening a dataset and inspecting it to performing
split-apply-combine pipelines. We have seen how to use Polars to manipulate
datasets and perform some basic feature engineering.</p>
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>Dataframes are combinations of series</p></li>
<li><p>Both Pandas and Polars can be used to manipulate them</p></li>
<li><p>The expression API in Polars allows to perform advanced operations with a
simple DSL.</p></li>
</ul>
</div>
</section>
<section id="see-also">
<h2>See also<a class="headerlink" href="#see-also" title="Link to this heading">¶</a></h2>
<p>There is a lot more to Polars than what we covered in this short introduction.
For example, queries like the ones we introduced can be performed lazily, i.e.
just declared and then run all together, giving the backend a chance to
optimise them. This can dramatically improve performance in the case of complex
queries. For this and a lot more, we refer you to the official
<a class="reference external" href="https://docs.pola.rs/">documentation</a>.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../interfacing-with-storage/">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Storage &amp; serialisation backends</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Home</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, ENCCS, The ENCCS TEAM
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link " href="https://github.com/ENCCS/python-for-hpda" aria-label="GitHub">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
                </svg>
            </a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Tabular data (aka Dataframes)</a><ul>
<li><a class="reference internal" href="#series-and-dataframes">Series and dataframes</a><ul>
<li><a class="reference internal" href="#tidy-vs-untidy-dataframes">Tidy vs untidy dataframes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pandas-polars">Pandas &amp; Polars</a><ul>
<li><a class="reference internal" href="#opening-a-dataset">Opening a dataset</a></li>
<li><a class="reference internal" href="#description-and-summarisation">Description and summarisation</a></li>
<li><a class="reference internal" href="#indexing">Indexing</a></li>
<li><a class="reference internal" href="#common-workflows">Common workflows</a></li>
</ul>
</li>
<li><a class="reference internal" href="#idiomatic-polars">Idiomatic Polars</a><ul>
<li><a class="reference internal" href="#expressions">Expressions</a></li>
<li><a class="reference internal" href="#contexts">Contexts</a></li>
<li><a class="reference internal" href="#transformations">Transformations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exercises">Exercises</a></li>
<li><a class="reference internal" href="#summary">Summary</a></li>
<li><a class="reference internal" href="#see-also">See also</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=187304be"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=46bd48cc"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=35a8b989"></script>
    <script src="../_static/minipres.js?v=a0d29692"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/tabs.js?v=3030b3cb"></script>
    </body>
</html>